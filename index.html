<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“– Nháº­t kÃ½ cÃ¡ nhÃ¢n báº£o máº­t</title>
<style>
body {
    font-family: "Georgia", serif;
    background: linear-gradient(120deg, #c9d6ff, #e2e2e2);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}
#auth-container, #diary-container {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    width: 400px;
}
h2 {
    text-align: center;
}
input, button, textarea {
    width: 100%;
    margin: 5px 0;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
}
button {
    background: #6b63ff;
    color: white;
    border: none;
    cursor: pointer;
    transition: 0.2s;
}
button:hover {
    background: #5548f0;
}

/* --- Nháº­t kÃ½ --- */
.book {
    position: relative;
    width: 350px;
    height: 450px;
    perspective: 2000px;
    margin: auto;
}
.page {
    width: 100%;
    height: 100%;
    background: #fffaf0;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    padding: 20px;
    box-sizing: border-box;
    position: absolute;
    top: 0;
    left: 0;
    backface-visibility: hidden;
    transform-origin: left center;
    transition: transform 0.6s ease;
    overflow-y: auto;
    font-family: "Times New Roman", serif;
    line-height: 1.5;
}
.page textarea {
    width: 100%;
    height: 100%;
    border: none;
    outline: none;
    background: transparent;
    resize: none;
    font-size: 16px;
}
.page.flipped {
    transform: rotateY(-180deg);
}
.page-number {
    position: absolute;
    bottom: 8px;
    right: 12px;
    font-size: 12px;
    color: #666;
}
.controls {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
}
#logoutBtn {
    background: #ff4d4d;
}
#newPageBtn {
    background: #ffa600;
}
#saveBtn {
    background: #4CAF50;
}
</style>
</head>
<body>

<!-- ÄÄƒng kÃ½/ÄÄƒng nháº­p -->
<div id="auth-container">
    <h2>ÄÄƒng kÃ½ / ÄÄƒng nháº­p</h2>
    <input type="text" id="username" placeholder="TÃ i khoáº£n">
    <input type="password" id="password" placeholder="Máº­t kháº©u">
    <input type="password" id="pin" placeholder="MÃ£ PIN (4 sá»‘)">
    <button id="registerBtn">ÄÄƒng kÃ½</button>
    <button id="loginBtn">ÄÄƒng nháº­p</button>
</div>

<!-- Giao diá»‡n nháº­t kÃ½ -->
<div id="diary-container" style="display:none;">
    <h2>ğŸ“– Nháº­t kÃ½ cá»§a <span id="userDisplay"></span></h2>
    <div class="book" id="book"></div>
    <div class="controls">
        <button id="prevPageBtn">â¬… Trang trÆ°á»›c</button>
        <button id="newPageBtn">+ Trang má»›i</button>
        <button id="nextPageBtn">Trang sau â¡</button>
    </div>
    <div class="controls">
        <button id="saveBtn">ğŸ’¾ LÆ°u</button>
        <button id="logoutBtn">ğŸšª ÄÄƒng xuáº¥t</button>
    </div>
</div>

<script>
const registerBtn = document.getElementById('registerBtn');
const loginBtn = document.getElementById('loginBtn');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const pinInput = document.getElementById('pin');
const authContainer = document.getElementById('auth-container');
const diaryContainer = document.getElementById('diary-container');
const userDisplay = document.getElementById('userDisplay');
const logoutBtn = document.getElementById('logoutBtn');
const saveBtn = document.getElementById('saveBtn');
const newPageBtn = document.getElementById('newPageBtn');
const book = document.getElementById('book');
const prevBtn = document.getElementById('prevPageBtn');
const nextBtn = document.getElementById('nextPageBtn');

let currentUser = null;
let currentPage = 0;
let data = null;

// Khi táº£i trang
window.onload = () => {
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (loggedInUser) {
        currentUser = loggedInUser;
        showDiary();
    }
};

// ÄÄƒng kÃ½
registerBtn.onclick = () => {
    const user = usernameInput.value.trim();
    const pass = passwordInput.value.trim();
    const pin = pinInput.value.trim();

    if (!user || !pass || !pin) return alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ tÃ i khoáº£n, máº­t kháº©u vÃ  mÃ£ PIN!");
    if (pin.length !== 4 || isNaN(pin)) return alert("MÃ£ PIN pháº£i gá»“m Ä‘Ãºng 4 chá»¯ sá»‘!");
    if (localStorage.getItem('user_' + user)) {
        alert("TÃ i khoáº£n Ä‘Ã£ tá»“n táº¡i!");
        return;
    }
    const data = { password: pass, pin: pin, pages: [""] };
    localStorage.setItem('user_' + user, JSON.stringify(data));
    alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng! HÃ£y Ä‘Äƒng nháº­p nhÃ©!");
};

// ÄÄƒng nháº­p
loginBtn.onclick = () => {
    const user = usernameInput.value.trim();
    const pass = passwordInput.value.trim();
    const pin = pinInput.value.trim();

    const stored = localStorage.getItem('user_' + user);
    if (!stored) return alert("TÃ i khoáº£n khÃ´ng tá»“n táº¡i!");
    const dataObj = JSON.parse(stored);

    if (dataObj.password !== pass) return alert("Sai máº­t kháº©u!");
    if (dataObj.pin !== pin) return alert("Sai mÃ£ PIN!");

    currentUser = user;
    localStorage.setItem('loggedInUser', user);
    showDiary();
};

// Hiá»ƒn thá»‹ nháº­t kÃ½
function showDiary() {
    authContainer.style.display = 'none';
    diaryContainer.style.display = 'block';
    userDisplay.textContent = currentUser;
    data = JSON.parse(localStorage.getItem('user_' + currentUser));
    renderBook();
    updatePageDisplay();
}

// Táº¡o cuá»‘n nháº­t kÃ½
function renderBook() {
    book.innerHTML = '';
    data.pages.forEach((content, i) => {
        const page = document.createElement('div');
        page.className = 'page';
        page.style.zIndex = data.pages.length - i; // trang sau náº±m trÃªn
        if (i < currentPage) page.classList.add('flipped');

        const textarea = document.createElement('textarea');
        textarea.value = content;
        page.appendChild(textarea);

        const num = document.createElement('div');
        num.className = 'page-number';
        num.textContent = `Trang ${i + 1}`;
        page.appendChild(num);

        book.appendChild(page);
    });
}

// Cáº­p nháº­t hiá»ƒn thá»‹ trang
function updatePageDisplay() {
    document.querySelectorAll('.page').forEach((page, i) => {
        if (i < currentPage) page.classList.add('flipped');
        else page.classList.remove('flipped');
    });
}

// NÃºt Ä‘iá»u hÆ°á»›ng
nextBtn.onclick = () => {
    if (currentPage < data.pages.length - 1) {
        currentPage++;
        updatePageDisplay();
    }
};
prevBtn.onclick = () => {
    if (currentPage > 0) {
        currentPage--;
        updatePageDisplay();
    }
};

// ThÃªm trang má»›i
newPageBtn.onclick = () => {
    data.pages.push("");
    currentPage = data.pages.length - 1;
    renderBook();
    updatePageDisplay();
};

// LÆ°u ná»™i dung
saveBtn.onclick = () => {
    const pages = Array.from(document.querySelectorAll('.page textarea')).map(t => t.value);
    data.pages = pages;
    localStorage.setItem('user_' + currentUser, JSON.stringify(data));
    alert("ğŸ’¾ ÄÃ£ lÆ°u nháº­t kÃ½ an toÃ n!");
};

// ÄÄƒng xuáº¥t
logoutBtn.onclick = () => {
    localStorage.removeItem('loggedInUser');
    currentUser = null;
    authContainer.style.display = 'block';
    diaryContainer.style.display = 'none';
};
</script>
</body>
</html>